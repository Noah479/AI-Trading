## 基础信息

**Base URL:** `http://127.0.0.1:5001`

**支持币种:** BTC-USDT, ETH-USDT, BNB-USDT, SOL-USDT, XRP-USDT, DOGE-USDT

**认证方式:** OKX API 密钥签名（服务端处理）

---

## 接口列表

### 1. 验证连接

验证 API 密钥是否有效，确认服务器连接状态。

**请求**

`GET /verify`

**响应示例（成功）**

json

`{
  "status": "success",
  "environment": "Simulated (Demo Trading)",
  "total_equity_usd": "10000.00",
  "keys_valid": true,
  "message": "Connection successful ✅"
}`

**响应示例（失败）**

json

`{
  "status": "failed",
  "keys_valid": false,
  "error": {
    "code": "50113",
    "msg": "Invalid signature"
  }
}`

---

### 2. 获取市场行情

获取所有支持币种的实时行情和 K 线数据。

**请求**

`GET /market`

**响应示例**

json

`{
  "data": {
    "BTC-USDT": {
      "price": 67234.5,
      "last": 67234.5,
      "high24h": 68000.0,
      "low24h": 66500.0,
      "candles": {
        "30m": [
          [67100.0, 67250.0, 67050.0, 67200.0, 123.45],
          [67200.0, 67350.0, 67180.0, 67234.5, 98.76]
        ],
        "4h": [
          [66800.0, 67500.0, 66500.0, 67200.0, 1234.56],
          [67200.0, 68000.0, 67000.0, 67234.5, 987.65]
        ]
      }
    },
    "ETH-USDT": {
      "price": 3456.78,
      "last": 3456.78,
      "high24h": 3500.0,
      "low24h": 3400.0,
      "candles": {
        "30m": [...],
        "4h": [...]
      }
    }
  }
}`

**K线数据格式**

每根 K 线为数组: `[open, high, low, close, volume]`

- 时间顺序：从旧到新（正序）
- 30m K线：最多返回 240 根
- 4h K线：最多返回 240 根

**缓存策略**

- 快照数据：2 秒缓存
- K线数据：10 分钟缓存

---

### 3. 获取账户余额

获取账户总权益和未实现盈亏。

**请求**

`GET /balance`

**响应示例**

json

`{
  "code": "0",
  "msg": "success",
  "totalEq": 10000.0,
  "unrealizedPnL": 123.45,
  "totalEq_incl_unrealized": 10123.45,
  "details": [
    {
      "ccy": "USDT",
      "eq": "10000.00",
      "availEq": "9500.00",
      "frozenBal": "500.00"
    }
  ]
}`

**字段说明**

- `totalEq`: 账户总权益（不含未实现盈亏）
- `unrealizedPnL`: 所有持仓的未实现盈亏总和
- `totalEq_incl_unrealized`: 包含未实现盈亏的总权益
- `details`: 各币种详细余额信息

---

### 4. 下单（模拟模式）

下达市价订单（当前为模拟模式，不实际发送到 OKX）。

**请求**

`POST /order
Content-Type: application/json`

**请求体**

json

`{
  "symbol": "BTC-USDT",
  "side": "buy",
  "size": 0.001,
  "order_type": "market"
}`

**参数说明**

| 参数 | 类型 | 必填 | 说明 |
| --- | --- | --- | --- |
| symbol | string | 是 | 交易对，如 "BTC-USDT" |
| side | string | 是 | 方向："buy" 或 "sell" |
| size | number | 是 | 下单数量（币的数量） |
| order_type | string | 否 | 订单类型，默认 "market" |

**响应示例**

json

`{
  "code": "0",
  "msg": "success",
  "data": [
    {
      "orderId": "MOCK-1730000000",
      "instId": "BTC-USDT",
      "side": "buy",
      "sz": "0.001",
      "ordType": "market"
    }
  ]
}`

**注意事项**

- 当前版本为**模拟模式**，不会实际下单到 OKX
- 仅用于测试交易流程和日志记录
- 如需真实下单，需取消注释代码中的真实下单逻辑

---

### 5. AI 状态（JSON）

获取 AI 交易系统的运行状态。

**请求**

`GET /ai/status`

**响应示例**

json

`{
  "status": "running",
  "last_update": "2025-10-27T10:30:00Z",
  "active_positions": 3,
  "total_trades_today": 12,
  "win_rate": 0.67
}`

**状态说明**

- 数据来源：`logs/ai_status.json` 文件
- 如文件不存在，返回空状态提示

---

### 6. AI 状态页面

获取 AI 状态的可视化页面。

**请求**

`GET /ai
GET /status`

**响应**

返回 HTML 页面，展示 AI 交易系统的实时状态。

---

### 7. 交易仪表盘

获取交易监控仪表盘页面。

**请求**

`GET /dashboard`

**响应**

返回 HTML 仪表盘页面，包含：

- 实时行情
- 账户信息
- 持仓状态
- 交易历史

---

### 8. 最近信号记录

获取最近的交易信号日志。

**请求**

`GET /recent/signals?limit=50`

**查询参数**

| 参数 | 类型 | 默认值 | 说明 |
| --- | --- | --- | --- |
| limit | integer | 50 | 返回记录数量 |

**响应示例**

json

`{
  "items": [
    {
      "timestamp": "2025-10-27T10:30:00Z",
      "symbol": "BTC-USDT",
      "signal": "BUY",
      "price": 67234.5,
      "reason": "突破阻力位"
    },
    {
      "timestamp": "2025-10-27T10:25:00Z",
      "symbol": "ETH-USDT",
      "signal": "SELL",
      "price": 3456.78,
      "reason": "跌破支撑位"
    }
  ]
}`

**数据说明**

- 来源：`logs/recent_signals.jsonl` 文件
- 排序：最新的信号在前（倒序）

---

### 9. 最近交易记录

获取最近的实际交易记录。

**请求**

`GET /recent/trades?limit=50`

**查询参数**

| 参数 | 类型 | 默认值 | 说明 |
| --- | --- | --- | --- |
| limit | integer | 50 | 返回记录数量 |

**响应示例**

json

`{
  "items": [
    {
      "timestamp": "2025-10-27T10:30:05Z",
      "orderId": "MOCK-1730000005",
      "symbol": "BTC-USDT",
      "side": "buy",
      "size": 0.001,
      "price": 67234.5,
      "status": "filled"
    },
    {
      "timestamp": "2025-10-27T10:25:10Z",
      "orderId": "MOCK-1730000010",
      "symbol": "ETH-USDT",
      "side": "sell",
      "size": 0.05,
      "price": 3456.78,
      "status": "filled"
    }
  ]
}`

**数据说明**

- 来源：`logs/recent_trades.jsonl` 文件
- 排序：最新的交易在前（倒序）

---

### 10. 日志文件访问

直接访问日志文件（CSV/JSONL格式）。

**请求**

`GET /logs/{filename}`

**路径参数**

- `filename`: 日志文件名，如 `recent_signals.jsonl`, `recent_trades.jsonl`

**响应**

返回原始日志文件内容。

**示例**

`GET /logs/recent_signals.jsonl
GET /logs/recent_trades.jsonl`

---

## 错误处理

所有接口在发生错误时返回统一格式：

**错误响应示例**

json

`{
  "status": "error",
  "error": "具体错误信息"
}`

**常见 HTTP 状态码**

- `200`: 成功
- `400`: 请求参数错误
- `500`: 服务器内部错误

---

## 技术细节

### 时间同步

所有需要签名的请求会自动从 OKX 服务器获取时间戳，确保时间同步。

### 模拟交易标识

所有请求头包含 `x-simulated-trading: 1`，标识为模拟交易环境。

### 行情更新机制

后台线程每 2 秒自动更新行情缓存，减少 API 调用频率。

### 日志存储位置

- 默认路径：`./logs/`
- 可通过环境变量 `LOG_DIR` 自定义

---

## 使用示例

### Python 示例

python

Run

View all

```python
import requests

BASE_URL = "http://127.0.0.1:5001"

# 获取市场行情
response = requests.get(f"{BASE_URL}/market")
data = response.json()
btc_price = data["data"]["BTC-USDT"]["price"]
print(f"BTC 价格: ${btc_price}")

# 下单
order = {
    "symbol": "BTC-USDT",
    "side": "buy",
    "size": 0.001
}
response = requests.post(f"{BASE_URL}/order", json=order)
print(response.json())

# 查询余额
response = requests.get(f"{BASE_URL}/balance")
balance = response.json()
print(f"总权益: ${balance['totalEq_incl_unrealized']}")

```

### cURL 示例

bash

`# 验证连接
curl http://127.0.0.1:5001/verify

# 获取行情
curl http://127.0.0.1:5001/market

# 下单
curl -X POST http://127.0.0.1:5001/order \
  -H "Content-Type: application/json" \
  -d '{"symbol":"BTC-USDT","side":"buy","size":0.001}'

# 获取余额
curl http://127.0.0.1:5001/balance

# 获取最近信号
curl "http://127.0.0.1:5001/recent/signals?limit=20"`

---

## 配置要求

服务启动前需在 `config.py` 中配置：

python

Run

`OKX_API_KEY = "your-api-key"
OKX_SECRET_KEY = "your-secret-key"
OKX_PASSPHRASE = "your-passphrase"
OKX_BASE_URL = "https://www.okx.com"  # 或模拟环境地址`

---

## 注意事项

1. **模拟交易模式**：当前 `/order` 接口为模拟模式，不会真实下单
2. **API 频率限制**：已实现缓存机制，避免触发 OKX 频率限制
3. **日志持久化**：所有信号和交易会记录到 JSONL 文件
4. **时区**：所有时间戳使用 UTC 时间